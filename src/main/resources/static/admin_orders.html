<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>관리자 주문 목록 (Dynamic) - Java Cafe</title>
    <!-- 폰트 로드 -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html, body {
            height: 100%;
        }

        body {
            font-family: 'Inter', 'Noto Sans KR', sans-serif;
            background-color: #F5F0E8; /* bg-light-beige */
            color: #6B4F3B; /* text-main-brown */
            line-height: 1.5;
            overflow-x: hidden; /* (추가) 뷰포트 가로 스크롤 방지 */
        }

        a {
            text-decoration: none;
            color: inherit;
        }

        /* --- 색상 변수 --- */
        :root {
            --main-brown: #6B4F3B;
            --header-bg: #A38C7D;
            --card-green: #AEC69F;
            --card-yellow: #F8D58B;
            --card-blue: #A9C8E8;
            --active-orange: #F9A825; /* bg-orange-400 (조금 더 선명하게) */
            --hover-orange: #FBC02D;  /* bg-orange-300 (조금 더 선명하게) */

            /* --- 요청하신 상단 바 CSS 변수 --- */
            --top-bar-bg: #F8C79D;
            --top-bar-text: #5A3E2B;
        }

        /* --- 레이아웃 --- */
        .wrapper {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); /* shadow-lg */
            background-color: #F5F0E8; /* 메인 배경색 */
        }

        /* --- (추가) 요청하신 상단 바 스타일 --- */
        .top-bar {
            display: flex;
            justify-content: space-between; /* 로고와 아이콘을 양 끝으로 정렬 */
            align-items: center;
            padding: 10px 15px;
            background-color: var(--top-bar-bg); /* 이미지의 상단 바 색상 */
            height: 60px; /* 높이 조정 */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); /* shadow-md */
        }

        .top-bar .logo-section {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .top-bar .logo-icon {
            font-size: 24px;
            width: 40px;
            height: 40px;
            background-color: rgba(255, 255, 255, 0.4);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .top-bar .logo-text {
            font-size: 22px;
            font-weight: bold;
            color: var(--top-bar-text); /* 이미지의 텍스트 색상 */
        }

        .top-bar .notification-icon {
            font-size: 24px;
            width: 40px;
            height: 40px;
            background-color: rgba(255, 255, 255, 0.4);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            position: relative; /* 팝업이 이 요소를 기준으로 위치하도록 설정 */
            cursor: pointer;    /* 클릭할 수 있는 요소임을 표시 */
            color: var(--top-bar-text); /* 아이콘 색상 */
        }

        /* 알림 팝업창 기본 스타일 */
        .notification-popup {
            display: none; /* (중요) 기본적으로 숨김 */
            position: absolute;
            top: calc(100% + 15px); /* 아이콘 래퍼 바로 아래 + 15px 여백 */
            right: -10px;          /* 아이콘 기준으로 오른쪽 정렬 (살짝 우측으로) */

            width: 220px;
            padding: 1rem;
            background-color: #ffffff;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            z-index: 100; /* 다른 요소들 위에 보이도록 설정 */

            color: #555;
            font-size: 0.9rem;
            text-align: center;
        }

        /* 팝업창을 보여주는 'show' 클래스 */
        .notification-popup.show {
            display: block; /* (중요) 이 클래스가 붙으면 보이게 함 */
        }

        /* 팝업창 위쪽의 작은 화살표 (꼬리) */
        .notification-popup .popup-arrow {
            position: absolute;
            top: -10px; /* 팝업창 상단보다 10px 위에 위치 */
            right: 18px; /* 팝업창 오른쪽 끝에서 18px 안쪽 */

            width: 0;
            height: 0;

            /* 삼각형 만들기 */
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-bottom: 10px solid #ffffff; /* 팝업창 배경색과 동일 */

            /* 테두리선과 겹치지 않게 그림자(테두리) 효과 추가 */
            filter: drop-shadow(0 -1px 0.5px #e0e0e0);
        }

        /* --- (기존 스타일) 메인 컨텐츠 --- */
        .main-content {
            flex: 1; /* flex-1 */
            padding: 2rem; /* p-8 */
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .main-title {
            font-size: 2.25rem; /* text-4xl */
            font-weight: 700; /* font-bold */
            color: var(--main-brown);
            text-align: center;
            margin-bottom: 2rem; /* mb-8 */
        }

        /* --- 주문 그리드 --- */
        .order-grid {
            display: grid;
            grid-template-columns: 1fr; /* 모바일 기본 */
            gap: 1.5rem; /* gap-6 */
            width: 100%;
        }

        /* (추가) 주문이 없을 때 메시지 */
        .order-grid-empty {
            text-align: center;
            font-size: 1.25rem;
            font-weight: 500;
            color: var(--main-brown);
            opacity: 0.7;
            padding: 2rem;
            background-color: rgba(255, 255, 255, 0.3);
            border-radius: 1rem;
        }


        /* 태블릿 (md) 분기점 (768px 이상) */
        @media (min-width: 768px) {
            .order-grid {
                grid-template-columns: repeat(2, 1fr); /* md:grid-cols-2 */
            }
        }

        /* --- 주문 카드 --- */
        .order-card {
            padding: 1.5rem; /* p-6 */
            border-radius: 1rem; /* rounded-2xl */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); /* shadow-lg */
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        /* * (수정) 주문 유형별 배경색
         * 요청사항: 매장(초록), 포장(초록), 배달(파랑)
         * -> 포장을 노란색으로 수정 (기존 더미데이터 기준)
        */
        .order-card.type-store { background-color: var(--card-green); }   /* 매장 */
        .order-card.type-takeout { background-color: var(--card-yellow); } /* 포장 */
        .order-card.type-delivery { background-color: var(--card-blue); }  /* 배달 */
        .order-card.type-default { background-color: #ddd; } /* 기타 */


        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem; /* mb-3 */
        }

        .order-id {
            background-color: white;
            color: var(--main-brown);
            font-size: 1.125rem; /* text-lg */
            font-weight: 700; /* font-bold */
            padding: 0.25rem 0.75rem; /* px-3 py-1 */
            border-radius: 9999px; /* rounded-full */
            border: 1px solid #eee;
        }

        .order-time {
            font-size: 1.125rem; /* text-lg */
            font-weight: 600; /* font-semibold */
        }

        .menu-list {
            list-style: none;
            font-size: 1.125rem; /* text-lg */
            margin-bottom: 1rem; /* mb-4 */
        }

        .menu-list li {
            margin-bottom: 0.25rem; /* space-y-1 */
        }

        .menu-list span {
            float: right;
        }

        .card-footer-row {
            display: flex;
            justify-content: space-between;
            font-size: 1.125rem; /* text-lg */
            font-weight: 600; /* font-semibold */
            margin-top: 0.5rem; /* mt-2 */
        }

        .card-footer-total {
            display: flex;
            justify-content: space-between;
            font-size: 1.25rem; /* text-xl */
            font-weight: 700; /* font-bold */
        }

        /* --- 하단 네비게이션 --- */
        .footer-nav {
            background-color: var(--main-brown);
            display: flex;
            justify-content: space-around;
            align-items: center;
        }

        .footer-nav-item {
            flex: 1; /* flex-1 */
            padding: 2rem 0; /* py-8 (요청하신대로 매우 크게) */
            text-align: center; /* text-center */
            color: white; /* text-white */
            font-size: 1.5rem; /* text-2xl (요청하신대로 매우 크게) */
            font-weight: 600; /* font-semibold */
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .footer-nav-item.active {
            background-color: var(--active-orange); /* bg-orange-400 */
        }

        .footer-nav-item:not(.active):hover {
            background-color: var(--hover-orange); /* bg-orange-300 */
        }

    </style>
</head>
<body>

<div class="wrapper">

    <!-- (수정) 상단 헤더 -->
    <header class="top-bar">
        <div class="logo-section">
            <span class="logo-icon">☕</span>
            <span class="logo-text">JavaBean</span>
        </div>
        <!-- (수정) 알림 아이콘 (기존 SVG 재사용 및 스타일 적용) -->
        <div class="notification-icon" id="notification-trigger">
            <svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" style="width: 20px; height: 20px;">
                <path d="M10 2a6 6 0 00-6 6v3.586l-.707.707A1 1 0 004 14h12a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6zM10 18a3 3 0 01-3-3h6a3 3 0 01-3 3z"></path>
            </svg>
            <div class="notification-popup" id="notification-popup">
                <div class="popup-arrow"></div> <p>주문내역이 없습니다.</p>
            </div>
        </div>
    </header>

    <!-- 메인 컨텐츠 영역 (주문 목록) -->
    <main class="main-content">
        <h2 class="main-title">주문 목록</h2>

        <!--
          (수정) 주문 그리드
          하드코딩된 6개의 카드를 모두 삭제했습니다.
          아래의 <script>가 이 div를 동적으로 채웁니다.
        -->
        <div class="order-grid" id="order-grid-container">
            <!-- 주문 카드가 여기에 동적으로 삽입됩니다. -->
        </div>
    </main>

    <!-- 하단 네비게이션 바 -->
    <footer class="footer-nav">
        <a href="#" class="footer-nav-item">메뉴 관리</a>
        <a href="#" class="footer-nav-item active">주문 관리</a>
        <a href="#" class="footer-nav-item">매출 관리</a>
        <a href="#" class="footer-nav-item">로그인</a>
    </footer>

</div>

<!-- (수정) 기존 /js/main.js 링크 대신 스크립트 직접 삽입 -->
<script>
    // 1. DOM이 모두 로드된 후 스크립트 실행
    document.addEventListener('DOMContentLoaded', () => {

        // --- 상수 및 변수 정의 ---

        // (중요) 실제 백엔드 API 엔드포인트로 수정해야 합니다.
        // OrderVO 객체의 리스트(List<OrderVO>)를 반환해야 합니다.
        // (수정) iFrame 환경에서 상대 경로가 작동하지 않는 오류를
        //        해결하기 위해, 전체 URL을 사용합니다.
        //        (서버가 http://localhost:8383 에서 실행 중이라고 가정)
        const API_ENDPOINT = 'http://localhost:8383/api/orders/admin-list';

        // (수정) 주문 목록을 실시간으로 새로고침할 간격 (ms)
        // 10000ms (10초) -> 3000ms (3초)로 변경
        // 이 값을 줄이면 더 "즉시" 반응하는 것처럼 보입니다.
        const POLLING_INTERVAL = 3000;

        // DOM 요소 캐시
        const orderGrid = document.getElementById('order-grid-container');
        const notificationTrigger = document.getElementById('notification-trigger');
        const notificationPopup = document.getElementById('notification-popup');


        // --- 함수 정의 ---

        /**
         * API에서 주문 데이터를 가져와 화면에 렌더링합니다.
         */
        async function fetchAndRenderOrders() {
            try {
                // (수정) fetch가 항상 최신 데이터를 요청하도록 cache: 'no-store' 옵션 추가
                const response = await fetch(API_ENDPOINT, { cache: 'no-store' });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                // API 응답이 OrderVO[] 형태라고 가정합니다.
                const orders = await response.json();

                // 렌더링 전 그리드 비우기
                orderGrid.innerHTML = '';

                if (!orders || orders.length === 0) {
                    // 주문이 없는 경우
                    orderGrid.innerHTML = '<div class="order-grid-empty">현재 접수된 주문이 없습니다.</div>';
                } else {
                    // 주문 목록 렌더링
                    orders.forEach(order => {
                        const cardHtml = createOrderCard(order);
                        orderGrid.insertAdjacentHTML('beforeend', cardHtml);
                    });
                }

            } catch (error) {
                console.error('주문 목록을 가져오는 데 실패했습니다:', error);
                orderGrid.innerHTML = '<div class="order-grid-empty">주문 목록을 불러오는 중 오류가 발생했습니다. (서버 연결 확인)</div>';
            }
        }

        /**
         * 주문 객체(order)를 받아 HTML 카드 문자열을 생성합니다.
         * (참고: OrderVO 구조는 더미데이터를 기반으로 가정했습니다.)
         */
        function createOrderCard(order) {
            // 1. 주문 유형(orderType)에 따른 CSS 클래스 결정
            let cardTypeClass = 'type-default'; // 기본값
            if (order.orderType === '매장') {
                cardTypeClass = 'type-store'; // 초록색
            } else if (order.orderType === '포장') {
                cardTypeClass = 'type-takeout'; // 노란색
            } else if (order.orderType === '배달') {
                cardTypeClass = 'type-delivery'; // 파란색
            }

            // 2. 주문 아이템 목록(orderItemList)을 <li> 태그로 변환
            // (참고: API가 'orderItemList' 배열을 반환한다고 가정)
            // (수정) orderItemList가 null일 경우를 대비하여 기본값(빈 배열) 제공
            const menuItemsHtml = (order.orderItemList || []).map(item => `
                    <li>${item.menuItemName || '알 수 없는 메뉴'} <span>${item.quantity || 0}</span></li>
                `).join('');

            // (수정) menuItemsHtml이 비어있을 경우 (주문 아이템이 없는 경우)
            const finalMenuItemsHtml = menuItemsHtml === '' ? '<li>주문 내역이 없습니다.</li>' : menuItemsHtml;

            // 3. 최종 HTML 카드 반환
            return `
                <div class="order-card ${cardTypeClass}">
                    <div>
                        <div class="card-header">
                            <span class="order-id">${order.orderId || '#000'}</span>
                            <!-- (수정) orderTime이 null일 경우를 대비 -->
                            <span class="order-time">${order.orderTime || '00:00'}</span>
                        </div>
                        <ul class="menu-list">
                            ${finalMenuItemsHtml}
                        </ul>
                    </div>
                    <div>
                        <div class="card-footer-row">
                            <span>총 수량</span>
                            <!-- (수정) totalQuantity가 null일 경우를 대비 -->
                            <span>${order.totalQuantity || 0}</span>
                        </div>
                        <div class="card-footer-total">
                            <span>${order.orderType || '알 수 없음'}</span>
                            <span>${(order.totalPrice || 0).toLocaleString('ko-KR')}원</span>
                        </div>
                    </div>
                </div>
            `;
        }


        // --- 이벤트 리스너 및 초기화 ---

        // 1. 알림 팝업 토글 이벤트
        notificationTrigger.addEventListener('click', (event) => {
            event.stopPropagation(); // 이벤트 버블링 방지
            notificationPopup.classList.toggle('show');
        });

        // 2. 팝업 외부 클릭 시 팝업 닫기
        document.addEventListener('click', (event) => {
            if (notificationPopup.classList.contains('show') && !notificationTrigger.contains(event.target)) {
                notificationPopup.classList.remove('show');
            }
        });

        // 3. 페이지 로드 시 즉시 주문 목록 가져오기
        fetchAndRenderOrders();

        // 4. (실시간 업데이트) 설정된 간격(POLLING_INTERVAL)마다 주문 목록 새로고침
        setInterval(fetchAndRenderOrders, POLLING_INTERVAL);

        console.log(`Admin Order Page script loaded. Polling every ${POLLING_INTERVAL / 1000} seconds.`);

    });
</script>

</body>
</html>