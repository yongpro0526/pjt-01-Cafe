<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Java Coffee</title>
    <link rel="stylesheet" th:href="@{/css/cart.css}">
</head>
<th:block th:replace="~{./include/userBaseLayout :: setContent( ~{:: .wrap} ) }">
    <div class="wrap">
        <div class="app-container">
            <main class="shopping-cart-combined" th:data-member-id="${memberId}">
                <h1 class="screen-1-title">장바구니</h1>

                <!-- ✅ 장바구니가 비어있을 때 -->
                <div th:if="${cartItems == null or #lists.isEmpty(cartItems)}" class="empty-cart-message"
                     th:style="${cartItems != null and not #lists.isEmpty(cartItems)} ? 'display: none;' : ''">
                    <p>장바구니가 비어있습니다.</p>
                    <a th:href="@{/menu/coffee}" class="go-to-menu-btn">메뉴 보러가기</a>
                </div>

                <!-- ✅ 장바구니에 아이템이 있을 때 -->
                <div th:if="${cartItems != null and not #lists.isEmpty(cartItems)}">
                    <div class="action-bar screen-1-content">
                        <label class="checkbox-container">
                            <input type="checkbox" id="selectAll" checked>
                            전체선택
                            <span class="checkmark"></span>
                        </label>
                        <button class="delete-btn" id="deleteSelectedBtn">선택삭제</button>
                    </div>

                    <div class="item-list screen-1-content">
                        <div th:each="item : ${cartItems}" class="cart-item"
                             th:data-price="${item.MENU_PRICE + (item.SHOT_COUNT * 500) + (item.VANILLA_SYRUP_COUNT * 500) + (item.WHIPPED_CREAM_COUNT * 500)}"
                             th:data-cart-item-id="${item['CART_ITEM_ID']}"
                             th:data-base-price="${item['MENU_PRICE']}"
                             th:data-option-price="${(item['SHOT_COUNT'] + item['VANILLA_SYRUP_COUNT'] + item['WHIPPED_CREAM_COUNT']) * 500}"
                             th:data-quantity="${item['QUANTITY']}">

                            <label class="checkbox-container">
                                <input type="checkbox" class="item-checkbox-input" checked>
                                <span class="checkmark item-checkbox"></span>
                            </label>

                            <img th:src="@{|/images/img/${item['MENU_IMG']}|}"
                                 th:alt="${item['MENU_NAME']}" class="item-img">

                            <div class="item-details">
                                <span class="item-temp"
                                      th:classappend="${item['TEMP'] == 'HOT' or item['TEMP'] == 'Hot' or item['TEMP'] == 'hot'} ? 'hot' : ''"
                                      th:text="${#strings.toUpperCase(item['TEMP'])}">temp</span>

                                <span class="item-name" th:text="${item['MENU_NAME']}">커피이름</span>

                                <span class="item-price-display"
                                      th:text="${#numbers.formatInteger(item['ITEM_TOTAL_PRICE'], 1, 'COMMA')} + '원'">
                                </span>

                                <p class="item-options"
                                   th:if="${item['TUMBLER_USE'] == true or item['TUMBLER_USE'] == 1 or item['SHOT_COUNT'] > 0 or item['VANILLA_SYRUP_COUNT'] > 0 or item['WHIPPED_CREAM_COUNT'] > 0}">

                                    <!-- 텀블러 사용 -->
                                    <span th:if="${item['TUMBLER_USE'] == true or item['TUMBLER_USE'] == 1}">
                                        텀블러 사용
                                        <span th:if="${item['SHOT_COUNT'] > 0 or item['VANILLA_SYRUP_COUNT'] > 0 or item['WHIPPED_CREAM_COUNT'] > 0}"> | </span>
                                    </span>

                                    <!-- 샷 추가 -->
                                    <span th:if="${item['SHOT_COUNT'] > 0}">
                                        샷 추가([[${item['SHOT_COUNT']}]])(+[[${item['SHOT_COUNT'] * 500}]]원)
                                        <span th:if="${item['VANILLA_SYRUP_COUNT'] > 0 or item['WHIPPED_CREAM_COUNT'] > 0}"> | </span>
                                    </span>

                                    <!-- 바닐라 시럽 -->
                                    <span th:if="${item['VANILLA_SYRUP_COUNT'] > 0}">
                                        바닐라 시럽([[${item['VANILLA_SYRUP_COUNT']}]])(+[[${item['VANILLA_SYRUP_COUNT'] * 500}]]원)
                                        <span th:if="${item['WHIPPED_CREAM_COUNT'] > 0}"> | </span>
                                    </span>

                                    <!-- 휘핑크림 -->
                                    <span th:if="${item['WHIPPED_CREAM_COUNT'] > 0}">
                                        휘핑크림([[${item['WHIPPED_CREAM_COUNT']}]])(+[[${item['WHIPPED_CREAM_COUNT'] * 500}]]원)
                                    </span>
                                </p>
                            </div>

                            <div class="item-controls">
                                <button class="control-btn minus-btn">-</button>
                                <!-- 수량 -->
                                <span class="item-quantity" th:data-quantity="${item.QUANTITY}"
                                      th:text="${item.QUANTITY}">1</span>
                                <button class="control-btn plus-btn">+</button>
                            </div>

                            <button class="item-remove">×</button>
                        </div>

                        <!-- 총 가격 -->
                        <div class="total-price-bar">
                            <span class="total-label">메뉴 가격</span>
                            <span class="total-amount" id="totalCartPrice"
                                  th:text="${#numbers.formatInteger(totalPrice, 1, 'COMMA')} + '원'">
                                0원
                            </span>
                        </div>
                    </div>

                <div class="order-details">
                    <div class="delivery-toggle">
                        <button class="delivery-btn active-delivery" data-type="delivery">배달</button>
                        <button class="delivery-btn" data-type="packaging">포장</button>
                    </div>

                    <div class="section-container request-section">
                        <div class="section-title">요청사항</div>
                        <div class="request-options">
                            <div class="col">
                                <label class="checkbox-container small">
                                    <input type="checkbox" class="request-option-checkbox"> 빨대 빼주세요.
                                    <span class="checkmark item-checkbox square"></span>
                                </label>
                                <label class="checkbox-container small">
                                    <input type="checkbox" class="request-option-checkbox"> 얼음 적게 넣어주세요.
                                    <span class="checkmark item-checkbox square"></span>
                                </label>
                                <label class="checkbox-container small">
                                    <input type="checkbox" class="request-option-checkbox" id="directInputCheck"> 직접입력
                                    <span class="checkmark item-checkbox square"></span>
                                </label>
                            </div>
                            <div class="col">
                                <label class="checkbox-container small">
                                    <input type="checkbox" class="request-option-checkbox"> 봉투에 담아갈게요
                                    <span class="checkmark item-checkbox square"></span>
                                </label>
                                <label class="checkbox-container small">
                                    <input type="checkbox" class="request-option-checkbox"> 캐리어에 담아갈게요.
                                    <span class="checkmark item-checkbox square"></span>
                                </label>
                            </div>
                        </div>
                        <textarea id="requestInput" placeholder="직접입력 선택 시 상세 내용을 적어주세요." rows="4"></textarea>
                    </div>

                    <div class="section-container payment-section">
                        <div class="section-title">결제수단</div>
                        <div class="payment-options">
                            <label class="checkbox-container radio-style">
                                <input type="radio" name="paymentMethod" value="simple" checked> 간편 결제
                                <span class="checkmark item-checkbox square"></span>
                            </label>
                            <label class="checkbox-container radio-style">
                                <input type="radio" name="paymentMethod" value="cash"> 만나서 직접 결제
                                <span class="checkmark item-checkbox square"></span>
                            </label>
                        </div>
                    </div>

                    <div class="final-summary">
                        <div class="summary-line">
                            <span class="label">상품 금액</span>
                            <span class="value" id="productPrice">0원</span>
                        </div>
                        <div class="summary-line">
                            <span class="label">배달비</span>
                            <span class="value" id="deliveryFee">0원</span>
                        </div>
                        <div class="summary-line final-total">
                            <span class="label total-label">총 가격</span>
                            <span class="value total-amount" id="finalTotalPrice">0원</span>
                        </div>
                        <button class="payment-btn">결제하기</button>
                    </div>
                </div>
            </main>
        </div>

        <script th:src="@{/js/cart.js}"></script>
    </div>
</th:block>
</html>